# 一.王树森推荐系统

## 1.推荐系统基础

### 1.1 推荐系统的基本概念

**消费指标：**

- 点击率 = 点击次数 / 曝光次数
- 点赞率 = 点赞次数 / 点击次数
- 收藏率 = 收藏次数 / 点击次数
- 转发率 = 转发次数 / 点击次数
- 阅读完成率 = 滑动到底次数 / 点击次数 * f(笔记长度)



**北极星指标：**

- 用户规模：日活用户数(DAU)、月活用户数(MAU)
- 消费：人均使用推荐的时长、人均阅读笔记的数量
- 发表：发布渗透率、人均发布量



**实验流程：**

![image-20250924150649831](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924150649831.png)



### 1.2 推荐系统的链路

![image-20250924150806069](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924150806069.png)

**召回通道：**

![image-20250924150947729](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924150947729.png)



**粗排、精排：**

![image-20250924151014394](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924151014394.png)

**重排：**

![image-20250924151140401](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924151140401.png)

### 1.3 推荐系统的AB测试

使用随机分桶+分层实验+Holdout机制+实验推全+反转实验：

![image-20250924151410399](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924151410399.png)

各个方法之间的详细说明：
![image-20250924151433628](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924151433628.png)





## 2.召回

### 2.1 基于物品的协同过滤(ItemCF)

==实现过程：==
![image-20250924152251324](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924152251324.png)

==两种相似度计算公式：==

![image-20250924152335001](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924152335001.png)

![image-20250924152345674](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924152345674.png)

==ItemCF召回的完整流程：==

![image-20250924161141512](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924161141512.png)



![image-20250924161220477](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924161220477.png)



==总结：==

![image-20250924161344729](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924161344729.png)

![image-20250924161405265](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924161405265.png)

### 2.2 Swing召回通道

==为了防止小圈子对召回通道造成影响==

![image-20250924161849399](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924161849399.png)

![image-20250924161858016](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924161858016.png)

![image-20250924161934704](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924161934704.png)

### 2.3 基于用户的协同过滤(UserCF)

==计算用户之间的相似度：==

![image-20250924162512671](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924162512671.png)

==召回的完整流程：==

![image-20250924162757971](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924162757971.png)

![image-20250924162824000](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924162824000.png)

==总结：==

![image-20250924162919633](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924162919633.png)

![image-20250924162929268](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924162929268.png)

### 2.4 离散特征处理

一种方法是One-Hot编码，一种是Embedding编码

![image-20250924163425576](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924163425576.png)

![image-20250924163205566](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924163205566.png)

![image-20250924163216001](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924163216001.png)

### 2.5 矩阵补充

==基本想法：==

![image-20250924163814648](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924163814648.png)

==数据集：==

![image-20250924163836815](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924163836815.png)

==训练：==

![image-20250924163906871](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924163906871.png)

![image-20250924163948157](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924163948157.png)

![image-20250924164112459](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924164112459.png)

==近似最近邻查找：==

![image-20250924164249471](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924164249471.png)

### 2.6 双塔模型：模型和训练

==模型形状：==后期融合

![image-20250924181902084](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924181902084.png)

==训练方式：==

![image-20250924181942105](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924181942105.png)

==Pointwise训练：==

![image-20250924183314194](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924183314194.png)

==Pairwise训练：==

![image-20250924183828784](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924183828784.png)

![image-20250924184019793](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924184019793.png)



==Listwise训练：==

![image-20250924185157015](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924185157015.png)

![image-20250924185212522](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924185212522.png)

==不适用于召回的模型：==前期融合，计算量过大

![image-20250924185706105](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250924185706105.png)



### 2.7 双塔模型：正负样本

==正采样：==

![image-20250925082533401](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925082533401.png)

==简单负样品的两种采集策略：==

==1.全体物品：==

![image-20250925082742900](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925082742900.png)

==2.Batch内负样本：==

![image-20250925083130131](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925083130131.png)

==困难负样本：==

![image-20250925083322995](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925083322995.png)

==总结：==

![image-20250925083350996](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925083350996.png)

### 2.8 双塔模型：线上召回和更新

==离线存储+线上召回：==

![image-20250925084457492](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925084457492.png)

![image-20250925084511098](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925084511098.png)

![image-20250925084542787](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925084542787.png)

![image-20250925084654335](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925084654335.png)

==模型更新：分为全量更新和增量更新==

==1.全量更新：==

![image-20250925085232085](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925085232085.png)

==2.增量更新：==

![image-20250925085413124](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925085413124.png)

![image-20250925085448467](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925085448467.png)

==双塔模型的总结：==

![image-20250925085824323](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925085824323.png)

![image-20250925085843281](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925085843281.png)

![image-20250925085852324](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925085852324.png)

### 2.9 双塔模型+自监督学习

没用过，先不记了





### 2.10 Deep Retrieval

应该用不到，先不学了



### 2.11 其他召回通道

![image-20250925091015843](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925091015843.png)



### 2.12 曝光过滤和Bloom Filter

==曝光过滤问题：==

![image-20250925091240302](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925091240302.png)

==Bloom Filter：==

![image-20250925091326555](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925091326555.png)





![image-20250925091343910](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925091343910.png)

![image-20250925091359699](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925091359699.png)

## 3.排序

### 3.1 多目标排序模型

![image-20250925091638617](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925091638617.png)

==多目标模型：==



![image-20250925091806948](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925091806948.png)

![image-20250925091821107](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925091821107.png)

![image-20250925091937140](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925091937140.png)

==预估值校准：==

![image-20250925092030846](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925092030846.png)

![image-20250925092043195](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925092043195.png)



### 3.2 MMoE

![image-20250925093248222](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925093248222.png)

![image-20250925093301743](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925093301743.png)

==这种算法可能会出现极化现象：==

![image-20250925093340945](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925093340945.png)

![image-20250925093403024](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925093403024.png)

### 3.3 预估分数的融合

==分数融合的几种例子：==

![image-20250925140152004](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925140152004.png)



![image-20250925141416247](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925141416247.png)



![image-20250925141734936](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925141734936.png)



![image-20250925141742751](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925141742751.png)

### 3.4 视频播放建模

==可以分别对视频播放时长和视频完播来建模:==

==视频播放时长：==

![image-20250925151434983](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925151434983.png)



![image-20250925151500635](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925151500635.png)

==视频完播：==

![image-20250925152220022](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925152220022.png)

![image-20250925152235388](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925152235388.png)

![image-20250925152246523](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925152246523.png)

### 3.5 排序模型的特征

![image-20250925152342930](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925152342930.png)

![image-20250925152424565](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925152424565.png)

### 3.6 粗排

==粗排的三塔模型：==

![image-20250925152613168](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925152613168.png)

![image-20250925152651503](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925152651503.png)

![image-20250925152711342](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925152711342.png)

![image-20250925152722256](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925152722256.png)

## 4.特征交叉

==这是几种解决交叉特征的方法：==

### 4.1 FM

![image-20250925153647424](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925153647424.png)

![image-20250925153729738](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925153729738.png)

![image-20250925153744014](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925153744014.png)

### 4.2 深度交叉网络(DCN)

==交叉层：==

![image-20250925154437373](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925154437373.png)



![image-20250925154606066](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925154606066.png)

==交叉网络：==

![image-20250925154905581](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925154905581.png)

==深度交叉网络：==

![image-20250925154943625](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925154943625.png)

### 4.3 LHUC网络结构

==一般用于精排==

![image-20250925160930195](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925160930195.png)

### 4.4 SENet和Bilinear Cross

没咋看懂，反正也是对于特征的处理



## 5.行为序列

它们的核心目标是根据用户过去交互过的物品序列（如点击、点赞的商品或视频）来生成一个能够代表该用户兴趣的特征向量

### 5.1 用户行为序列建模

![image-20250925163628665](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925163628665.png)



![image-20250925163635429](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925163635429.png)

![image-20250925163648867](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925163648867.png)



### 5.2 DIN模型

![image-20250925165253326](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925165253326.png)

![image-20250925165305816](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925165305816.png)

![image-20250925165331866](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925165331866.png)

![image-20250925165355790](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925165355790.png)

### 5.3 SIM模型

==解决 DIN 难以处理长序列（长期兴趣）的问题。==

![image-20250925170220439](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925170220439.png)

![image-20250925170231785](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925170231785.png)

![image-20250925170247955](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925170247955.png)



![image-20250925170257675](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925170257675.png)

## 6.重排

### 6.1 推荐系统中的多样性

==物品相似度的度量：==

==1.基于物品属性标签==

![image-20250925181232982](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925181232982.png)

==2.基于图文内容的物品向量表征==

![image-20250925181533767](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925181533767.png)

![image-20250925181246061](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925181246061.png)



==提升多样性的方法：==

![image-20250925181624307](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925181624307.png)

![image-20250925181645216](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925181645216.png)

### 6.2 MMR

![image-20250925182338863](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925182338863.png)

![image-20250925182408203](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925182408203.png)

==应用滑动窗口的MMR：==

![image-20250925182444180](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925182444180.png)

### 6.3 重排的规则

![image-20250925182722663](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925182722663.png)

![image-20250925182730320](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925182730320.png)

![image-20250925182739084](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925182739084.png)

==MMR+重排规则：==

![image-20250925182803013](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925182803013.png)

### 6.4 DPP算法的数学原理

![image-20250925191543344](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925191543344.png)

![image-20250925191518421](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925191518421.png)

### 6.5 DPP算法应用

![image-20250925193916090](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925193916090.png)

![image-20250925193942859](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925193942859.png)



![image-20250925194002039](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925194002039.png)

![image-20250925194017220](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925194017220.png)



![image-20250925194037015](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925194037015.png)



==可以使用滑动窗口和规则约束来求解DPP==

![image-20250925194121421](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925194121421.png)

![image-20250925194131350](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250925194131350.png)

## 7.物品冷启动

### 7.1 优化目标&评价指标

==冷启动的指标：==

![image-20250926094417239](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926094417239.png)

==作者侧指标：==

==1.发布渗透率：==

![image-20250926094600766](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926094600766.png)

==2.人均发布量：==

![image-20250926094623450](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926094623450.png)

==用户侧指标：==

==1.新笔记的消费指标：==

![image-20250926094720596](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926094720596.png)

==2.大盘消费指标：==

![image-20250926094747810](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926094747810.png)

==内容侧指标：==

![image-20250926094916689](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926094916689.png)

==冷启动的优化点：==

![image-20250926095130078](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926095130078.png)

### 7.2 简单的召回通道

由于新物品的ID Embedding向量还没有得到确切的值，所以不适用于ItemCF召回

![image-20250926100928537](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926100928537.png)

==双塔模型的召回：==

![image-20250926101028567](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926101028567.png)

![image-20250926101037340](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926101037340.png)

![image-20250926101056249](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926101056249.png)

==类目召回：==

![image-20250926101204804](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926101204804.png)

![image-20250926101214878](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926101214878.png)

### 7.3 聚类召回

==聚类召回的使用过程：==

![image-20250926101448675](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926101448675.png)

![image-20250926140630270](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926140630270.png)

![image-20250926140651189](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926140651189.png)

==内容相似度模型：==

尽量让正的数值靠近1，负的数值靠近-1

![image-20250926142532102](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926142532102.png)

![image-20250926142546728](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926142546728.png)

![image-20250926142558806](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926142558806.png)

![image-20250926142608668](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926142608668.png)

![image-20250926142620316](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926142620316.png)

### 7.4 Look-Alike人群扩散

==计算两个用户之间相似度的方法：==

1.使用UserCF：通过两个用户共同的兴趣点来计算两个用户之间的相似度

2.Embedding：如果两个用户向量之间的cos值大，那么就说明这两个这个两个用户之间的相似度大

![image-20250926143248073](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926143248073.png)

![image-20250926143302305](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926143302305.png)

![image-20250926143318788](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926143318788.png)

![image-20250926143329261](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926143329261.png)

### 7.5 流量调控

![image-20250926143848942](https://typora-picture-wang.oss-cn-shanghai.aliyuncs.com/image-20250926143848942.png)

### 7.6 AB测试

